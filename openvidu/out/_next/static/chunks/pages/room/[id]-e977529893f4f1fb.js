(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{7865:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[id]",function(){return t(3614)}])},7337:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return s}});var r=t(5893),o=t(7294),a=t(4533),i=t.n(a);function s(e){let n=o.createRef();return(0,o.useEffect)(()=>{e&&n&&e.streamManager.addVideoElement(n.current)}),(0,r.jsx)("div",{children:(0,r.jsx)("video",{autoPlay:!0,ref:n,className:i().videofilter})})}},5880:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return m}});var r=t(2729),o=t(5893),a=t(508),i=t(7294),s=t(1163),c=t(1649),l=t(5019);function u(){let e=(0,r._)(['\n    font-family: "LeeSeoyun";\n\n    position: absolute;\n    bottom: 16px;\n    left: 220px;\n\n    background: url("/room/bowl.png") no-repeat center/cover !important;\n    width: 160px;\n    height: 120px;\n    cursor: pointer;\n\n    font-weight: bold;\n    font-size: 24px;\n    color: #000; /* 텍스트 색상 */\n    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n    transition: all 0.3s ease;\n\n    &:hover {\n      transform: rotate(10deg); /* X축으로 20도만큼 기울임 */\n      font-size: 26px;\n    }\n  ']);return u=function(){return e},e}function d(){let e=(0,r._)(['\n    font-family: "LeeSeoyun";\n\n    position: absolute;\n    bottom: 16px;\n    right: 450px;\n\n    background: url("/room/chapstick.png") no-repeat center/cover !important;\n    width: 180px;\n    height: 40px;\n    cursor: pointer;\n\n    font-weight: bold;\n    font-size: 24px;\n    color: #000; /* 텍스트 색상 */\n    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n    transition: all 0.3s ease;\n\n    &:hover {\n      transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n      font-size: 26px;\n    }\n  ']);return d=function(){return e},e}function p(){let e=(0,r._)(['\n    font-family: "LeeSeoyun";\n\n    position: absolute;\n    bottom: 16px;\n    right: 260px;\n\n    background: url("/room/pot.png") no-repeat center/cover !important;\n    width: 180px;\n    height: 120px;\n    cursor: pointer;\n\n    font-weight: bold;\n    font-size: 36px;\n    color: #000; /* 텍스트 색상 */\n    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n    transition: all 0.3s ease;\n\n    &:hover {\n      transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n      font-size: 40px;\n    }\n  ']);return p=function(){return e},e}function f(){let e=(0,r._)(['\n    font-family: "LeeSeoyun";\n\n    position: absolute;\n    bottom: 16px;\n    right: 260px;\n\n    background: url("/room/pot.png") no-repeat center/cover !important;\n    width: 180px;\n    height: 120px;\n    cursor: pointer;\n\n    font-weight: bold;\n    font-size: 36px;\n    color: #000; /* 텍스트 색상 */\n    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n    transition: all 0.3s ease;\n\n    &:hover {\n      transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n      font-size: 40px;\n    }\n  ']);return f=function(){return e},e}function m(e){(0,s.useRouter)();let n=(0,c.I0)(),t=a.ZP.button(u()),r=a.ZP.button(d()),m=a.ZP.button(p()),h=a.ZP.button(f()),x=e.info,[g]=(0,i.useState)(e.client);(0,i.useState)(e.ready);let v=(0,c.v9)(e=>e.room.currentIncludeMini),_=(0,c.v9)(e=>e.room.currentRoomId),y="https://ohogame.shop/enter/room/?roomId="+_,b=()=>{navigator.clipboard.writeText(y),alert("클립보드에 URL이 복사되었습니다.")},N=e=>{let n={playerId:x.playerId,ready:e};g.current?g.current.send("/ready/".concat(x.roomId),{},JSON.stringify(n)):alert("소켓 연결 실패!")};return(0,o.jsxs)("div",{style:{marginTop:"20px"},children:[e.head&&(0,o.jsx)(t,{onClick:()=>{n((0,l.eA)())},children:!0==v?"미니게임 모드":"기본 모드"}),(0,o.jsx)(r,{onClick:()=>{b()},children:"초대하기"}),!0===e.head?!0!==e.startGame?(0,o.jsx)(h,{children:"시작불가"}):(0,o.jsx)(h,{onClick:()=>{g.current?g.current.send("/game/".concat(x.roomId),{},JSON.stringify({includeMini:v})):alert("소켓 연결 실패!")},children:"시 작"}):(0,o.jsxs)(m,{onClick:()=>{N(e.ready)},children:[" ",!1===e.ready?"준 비":"준비완료"]})]})}},6788:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var r=t(5893);t(7294);var o=t(7337),a=t(1649),i=t(9255),s=t.n(i),c=t(4533),l=t.n(c);function u(){let e=(0,a.v9)(e=>e.openvidu.session),n=(0,a.v9)(e=>e.player.currentNick),t=(0,a.v9)(e=>e.openvidu.publisher),i=(0,a.v9)(e=>e.openvidu.participants);return console.log("Room Cam"),console.log(t),console.log(i),(0,r.jsx)("div",{className:"container",children:void 0!==e?(0,r.jsx)("div",{id:"session",children:(0,r.jsxs)("div",{id:"video-container",className:s().camList,children:[null!=i?i.map((e,n)=>null!=e?(0,r.jsxs)("span",{className:l().streamcomponent,children:[(0,r.jsx)(o.default,{className:s().cam,streamManager:e.participant}),console.log(e.nick),(0,r.jsx)("div",{className:l().nickname,children:e.nick})]},e.id):null):null,void 0!==t?(0,r.jsxs)("span",{className:l().streamcomponent,children:[(0,r.jsx)(o.default,{className:s().cam,streamManager:t}),(0,r.jsx)("div",{className:l().nickname,children:n})]}):null]})}):null})}},9180:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return s}});var r=t(5893),o=t(7294),a=t(9255),i=t.n(a);function s(e){let n=e.info,[t]=(0,o.useState)(e.client);console.log(n),console.log(t);let[a,s]=(0,o.useState)(""),[c,l]=(0,o.useState)(""),[u,d]=(0,o.useState)(0),[p,f]=(0,o.useState)(!0),m=e=>{s(e.target.value)},h=e=>{"Enter"===e.key&&(e.preventDefault(),x(),s(""))},x=()=>{if(l(a),c===a){if(d(u+1),u>=4){f(!1),alert("5회 이상 같은 채팅을 입력하셨습니다."),d(0),s("");return}}else d(0);if(""===a)alert("입력된 메시지가 없습니다.");else if(t.current){var e={playerId:n.nick,message:a};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}s("")};(0,o.useEffect)(()=>{let e=setTimeout(()=>{f(!0)},15e3);return()=>clearTimeout(e)},[p]);let g=(0,o.useRef)(null);(0,o.useEffect)(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[e.chatHistory]);let v=()=>{if(""===a){var e={playerId:"입장 알림봇",message:"".concat(n.nick,"님이 입장하셨습니다.")};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}s("")};return(0,o.useEffect)(()=>{setTimeout(()=>{v()},1e3)},[]),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:i().outerChat,children:(0,r.jsx)("div",{className:i().innerChat,children:(0,r.jsx)("textarea",{ref:g,className:i().chatArea,readOnly:!0,value:e.chatHistory})})}),p?(0,r.jsx)("input",{type:"text",className:i().chatInput,value:a,onChange:m,onKeyDown:h}):null,p?null:(0,r.jsx)("input",{type:"text",className:i().chatInput,placeholder:"15초 후에 채팅이 가능합니다.",value:a,onChange:m,onKeyDown:h,disabled:!0}),(0,r.jsx)("button",{className:i().sendBtn,onClick:x,children:"전송"})]})}},3614:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var r=t(5893),o=t(7294),a=t(1163),i=t(6788),s=t(9180),c=t(5880),l=t(6154),u=t(8e3),d=t.n(u),p=t(4593),f=t(1649),m=t(7667),h=t(5989),x=t(7033),g=t(5523),v=t(9255),_=t.n(v),y=t(4905);function b(){let e=(0,a.useRouter)(),n=(0,f.I0)(),t=e.query.currentName?JSON.parse(e.query.currentName):"",u=new y.OpenVidu,v=u.initSession({sessionTimeout:3600});n(x.Ft.createOpenVidu({OV:u,session:v}));let b=null,N=(0,f.v9)(e=>e.room.currentRoomId),w=(0,f.v9)(e=>e.player.currentPlayerId),j=(0,f.v9)(e=>e.player.currentNick),k=(0,f.v9)(e=>e.player.currentHead),P=(0,f.v9)(e=>e.player.currentReady),S=(0,f.v9)(e=>e.players.canStart),[I,R]=(0,o.useState)("".concat(t.nick,"님이 입장하셨습니다.")+"\n"),C=()=>{(0,l.Z)({url:"https://ohogame.shop/api"+"/player/".concat(N),header:{Accept:"application/json","Content-type":"application/json;charset=UTF-8"},method:"POST",data:{id:w}}).then(e=>{n((0,m.zv)([]));let t=e.data.length;for(let r=0;r<t;r++){let t=e.data[r].head,o=e.data[r].id,a=e.data[r].nickname,i=e.data[r].ready,s={head:t,playerId:o,nick:a,ready:i};n((0,m.DB)(s)),n((0,m.rQ)({id:o,nickname:a,ready:i,head:t}))}n((0,m.aD)())}).catch(n=>{n.response?e.push({pathname:"/exception",query:{msg:n.response.data}}):console.log("error ::: ",n)})},E=async()=>{n((0,m.Pw)({id:w})),await O.current.send("/leave/".concat(N),{},JSON.stringify({playerId:w}))},O={},L=()=>{O.current=p.L.over(()=>{let e=new(d())("https://ohogame.shop/ws");return e})},T=()=>{O.current.connect({},()=>{O.current.subscribe("/topic/chat/".concat(N),e=>{var n=JSON.parse(e.body);R(e=>e+n.message+"\n")}),O.current.subscribe("/topic/player/".concat(N),e=>{var t=JSON.parse(e.body);n((0,m.Q)(t)),n((0,m.aD)()),t.id==w&&n((0,h.Cd)(t))}),b=O.current.subscribe("/topic/game/".concat(N),r=>{var o=JSON.parse(r.body);console.log("게임 데이터"),console.log(o),void 0==o.error||null==o.error?(n((0,g.es)(o.cellList)),n((0,g.BY)(o.playerIdList)),e.push({pathname:"/game/".concat(N),query:{currentName:JSON.stringify(t)}},"/game/".concat(N))):alert("알림 : "+o.error)})})},D=async e=>{await E()},J=async t=>{try{v.on("streamCreated",async e=>{n(x.Ft.enteredParticipant(e.stream))}),v.on("streamDestroyed",e=>{n(x.Ft.deleteParticipant(e.stream.streamManager))}),v.on("exception",e=>{console.warn(e)}),await v.connect(t,{clientData:j,publisher:!0});let e=await u.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1,sessionTimeout:3600});var r=(await u.getDevices()).filter(e=>"videoinput"===e.kind),o=e.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId,a=r.find(e=>e.deviceId===o);n(x.Ft.createPublisher({publisher:e,currentVideoDevice:a}))}catch(n){console.log(n),e.push({pathname:"/exception",query:{msg:"화상 연결에 문제가 있어요!"}})}};(0,o.useEffect)(()=>(J(w),n((0,m.ai)()),C(),L(),T(),window.addEventListener("beforeunload",D),()=>{window.removeEventListener("beforeunload",D),b&&(console.log("구독해제"),b.unsubscribe())}),[]);let M=(0,o.useMemo)(()=>(0,r.jsx)(i.default,{}),[]),z=(0,o.useMemo)(()=>(0,r.jsx)(s.default,{info:t,client:O,chatHistory:I}),[I]),A=(0,o.useMemo)(()=>(0,r.jsx)(c.default,{info:t,client:O,head:k,ready:P,startGame:S}),[P,S]);return(0,r.jsxs)("div",{className:_().container,children:[(0,r.jsx)("div",{className:"roof2"}),(0,r.jsxs)("div",{className:_().room,children:[(0,r.jsx)("div",{className:_().camList,style:{marginTop:"50px",marginBottom:"10px",textAlign:"center"},children:M}),z,A]})]})}},9255:function(e){e.exports={container:"RoomPage_container__nrifP",room:"RoomPage_room__jZJqd",camList:"RoomPage_camList__pr94X",cam:"RoomPage_cam__bKlCM",chatContainer:"RoomPage_chatContainer__Hlg7I",outerChat:"RoomPage_outerChat__j4Ee0",innerChat:"RoomPage_innerChat__ZniE2",chatUnit:"RoomPage_chatUnit__9sfcL",sender:"RoomPage_sender__9HCU2",time:"RoomPage_time__4KvWW",message:"RoomPage_message__3J_1w",chatArea:"RoomPage_chatArea__njIvi",chatInput:"RoomPage_chatInput__xkHum",sendBtn:"RoomPage_sendBtn__836RZ"}},4533:function(e){e.exports={streamcomponent:"UserVideo_streamcomponent__72vDQ",nickname:"UserVideo_nickname__IX3Tw",videofilter:"UserVideo_videofilter__Ua11Z"}}},function(e){e.O(0,[154,894,774,888,179],function(){return e(e.s=7865)}),_N_E=e.O()}]);